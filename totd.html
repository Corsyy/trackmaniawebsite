<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Track of the Day</title>
<style>
:root{--bg:#0a0f1a;--panel:#0f1524;--text:#e6ecff;--muted:#9db1ff;--accent:#6dfbff;--border:rgba(109,251,255,.2)}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,Segoe UI,Roboto,Ubuntu,Helvetica Neue,sans-serif;background:var(--bg);color:var(--text)}
header{background:var(--panel);border-bottom:1px solid var(--border)}.container{width:min(1100px,92vw);margin:0 auto;padding:1rem}
h1{margin:0 0 .25rem}.nav a{color:var(--accent);text-decoration:none;margin-right:1rem}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem;margin-top:1rem}
.card{background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.thumb{aspect-ratio:16/9;background:#08101c}.thumb img{width:100%;height:100%;object-fit:cover;display:block}
.meta{padding:.8rem}.date{opacity:.8;font-size:.9rem}.badge{border:1px solid var(--border);padding:.2rem .5rem;border-radius:999px;font-size:.85rem;background:rgba(109,251,255,.06)}
.select{margin-top:.5rem}select{background:#0c1322;border:1px solid var(--border);color:var(--text);padding:.4rem .6rem;border-radius:10px}
.hero{display:flex;gap:1rem;margin:1rem 0;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:1rem}
.hero .thumb{width:320px;flex:0 0 auto}
@media(max-width:800px){.hero{flex-direction:column}.hero .thumb{width:auto}}
</style></head><body>
<header><div class="container">
  <h1>Track of the Day</h1>
  <div class="nav"><a href="/">Home</a> <a href="./cotd.html">Cup of the Day</a></div>
  <div class="select">Month: <select id="month"></select></div>
</div></header>
<main class="container">
  <section id="today" class="hero">
    <div class="thumb" id="t-thumb"></div>
    <div>
      <h2 id="t-name">(loading…)</h2>
      <p>Author: <span class="badge" id="t-author">—</span></p>
      <p id="t-date" class="date"></p>
    </div>
  </section>
  <section class="grid" id="grid"></section>
</main>
<script>
  // ------------ small utils ------------
  const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  const bust = () => `?t=${Date.now()}`;
  const labelFromKey = (key) => {
    const [y, m] = key.split("-");
    return `${MONTHS[parseInt(m, 10) - 1]} ${y}`;
  };
  const maxDateKey = (days) => Object.keys(days).sort().pop(); // "YYYY-MM-DD"

  async function jget(url) {
    const r = await fetch(url + bust());
    if (!r.ok) throw new Error(`GET ${url} -> ${r.status}`);
    return r.json();
  }

  // ------------ renderers (adapt selectors to your DOM) ------------
  function renderHero(rec) {
    // rec: { date, map: { name, authorDisplayName, thumbnailUrl } }
    const heroTitle = document.querySelector("#totd-hero-title") || document.querySelector(".totd-hero-title");
    const heroAuthor = document.querySelector("#totd-hero-author") || document.querySelector(".totd-hero-author");
    const heroImg = document.querySelector("#totd-hero-img") || document.querySelector(".totd-hero-img");
    const heroDate = document.querySelector("#totd-hero-date") || document.querySelector(".totd-hero-date");
    if (heroTitle) heroTitle.textContent = rec.map.name || "(unknown map)";
    if (heroAuthor) heroAuthor.textContent = rec.map.authorDisplayName || "—";
    if (heroImg && rec.map.thumbnailUrl) heroImg.src = rec.map.thumbnailUrl;
    if (heroDate) heroDate.textContent = rec.date;
  }

  function renderGrid(days) {
    // expects a container to append cards into; tweak to your markup
    const grid = document.querySelector("#totd-grid") || document.querySelector(".totd-grid");
    if (!grid) return;
    grid.innerHTML = "";
    const keys = Object.keys(days).sort(); // oldest -> newest
    for (const k of keys) {
      const d = days[k];
      const card = document.createElement("div");
      card.className = "totd-card";
      card.innerHTML = `
        <div class="thumb-wrap"><img src="${d.map.thumbnailUrl || ""}" alt=""></div>
        <div class="meta">
          <div class="date">${d.date}</div>
          <div class="name">${d.map.name || "(unknown map)"}</div>
          <div class="author">${d.map.authorDisplayName || "—"}</div>
        </div>
      `;
      grid.appendChild(card);
    }
  }

  // ------------ main page logic ------------
  async function loadMonth(key) {
    const data = await jget(`data/totd/${key}.json`);
    // hero: prefer totd.json if it matches this month, else use latest day in month file
    let hero = null;
    try {
      const today = await jget(`totd.json`);
      if (today?.date && data.days[today.date]) hero = data.days[today.date];
    } catch (_) {}
    if (!hero) {
      const latestKey = maxDateKey(data.days);
      hero = data.days[latestKey];
    }
    renderHero(hero);
    renderGrid(data.days);
  }

  async function init() {
    const sel = document.querySelector("#month-select") || document.querySelector("#month");
    const monthsJ = await jget(`data/totd/months.json`);
    const months = Array.isArray(monthsJ.months) ? monthsJ.months.slice().sort().reverse() : [];
    if (!months.length) {
      if (sel) { sel.innerHTML = `<option>(no data yet)</option>`; }
      return;
    }
    // build dropdown strictly from JSON (no current-date guessing)
    if (sel) {
      sel.innerHTML = "";
      for (const k of months) {
        const opt = document.createElement("option");
        opt.value = k;
        opt.textContent = labelFromKey(k);
        sel.appendChild(opt);
      }
      sel.value = months[0]; // newest by default
      sel.onchange = () => loadMonth(sel.value);
    }
    await loadMonth(months[0]);
  }

  init().catch(console.error);
</script>
</body></html>
