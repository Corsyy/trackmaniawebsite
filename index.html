<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trackmania Events ‚Äî Official Site</title>
  <meta name="description" content="Live Trackmania events, schedule, and stream hub. Watch live on Twitch, see upcoming events, and get in touch." />
  <meta name="theme-color" content="#0a0f1a" />
  <meta property="og:title" content="Trackmania Events ‚Äî Official Site" />
  <meta property="og:description" content="Live Trackmania events, schedule, and stream hub." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://trackmaniaevents.com/" />
  <meta name="twitter:card" content="summary_large_image" />
  <script id="event-jsonld" type="application/ld+json">{}</script>
  <link rel="icon" type="image/png" sizes="32x32" href="/logo.png">
  <link rel="apple-touch-icon" href="/logo.png">
  <link rel="shortcut icon" href="/logo.png">
  <link rel="stylesheet" href="/style.css">

</head>

<body class="bg-aurora">

<header>
  <div class="container nav">
    <a class="brand" href="#" aria-label="Trackmania Events Home">
      <span class="brand-badge" aria-hidden="true">üéÆ</span>
      <span>Trackmania Events</span>
    </a>
    <button id="navToggle" class="nav-toggle" aria-expanded="false" aria-controls="primary-nav">‚ò∞</button>
    <nav id="primary-nav" class="navlinks" aria-label="Primary">
      <a href="/kacky">Kacky Finishes</a>
      <a href="/wrleaderboard">WR Leaderboard</a>
      <a href="/totd">Track of the Day</a>
      <a href="/highlights">Community Highlights</a>
    </nav>
    <div class="cta">
</form>
      <a class="btn" href="#contact">Contact</a>
    </div>
  </div>
</header>

<script>
  (function(){
    const btn=document.getElementById('navToggle');
    const nav=document.getElementById('primary-nav');
    if(!btn||!nav) return;
    btn.addEventListener('click',()=>{
      const open=nav.classList.toggle('show');
      btn.setAttribute('aria-expanded',open?'true':'false');
    });
  })();
</script>

<section class="hero" id="home">
  <div class="container hero-grid">

    <div class="hero-top">
      <span class="chip" id="hero-chip">Next Event</span>
      <h1 class="h1">Live Trackmania events and community races</h1>
      <p class="lead">Your central hub for upcoming events, live streams, and highlights.</p>

      <div class="keyfacts" id="hero-pills">
        <div class="pill">üóìÔ∏è TBA</div>
        <div class="pill">üìç Online</div>
        <div class="pill">üèÅ Community races</div>
      </div>
    </div>

    <div class="hero-row">
      <div>
        <div class="card" id="countdown-card" aria-live="polite">
          <div class="card-header">
            <strong id="countdown-title">Countdown to green light</strong>
          </div>
          <div class="card-body">
            <div class="countdown" id="countdown">
              <div class="timebox"><strong id="d">0</strong><span>Days</span></div>
              <div class="timebox"><strong id="h">0</strong><span>Hours</span></div>
              <div class="timebox"><strong id="m">0</strong><span>Minutes</span></div>
              <div class="timebox"><strong id="s">0</strong><span>Seconds</span></div>
            </div>
            <div style="margin-top:.9rem">
              <button class="btn" id="addCal">Add to Calendar</button>
            </div>
          </div>
        </div>
      </div>

      <div id="live" class="live">
        <div class="card reveal">
          <div class="card-header"><strong>Live on Twitch</strong></div>
          <div class="card-body">
            <div id="twitch-embed"></div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<section id="live-events" class="section">
  <div class="container">
    <h2 class="title">Live Now</h2>
    <div class="grid" id="live-events-grid"></div>
  </div>
</section>

<section id="schedule" class="section">
  <div class="container">
    <h2 class="title">Upcoming Events</h2>
    <div class="grid" id="events-grid">
      <article class="event"><div class="meta">Loading schedule‚Ä¶</div></article>
    </div>
  </div>
</section>

<section id="showcase" class="section">
  <div class="container">
    <h2 class="title">Highlights</h2>
    <div class="cards">
      <article class="shot reveal">
        <div class="media">Clip / Screenshot</div>
        <div class="text"><strong></strong><div class="meta">N/A</div></div>
      </article>
      <article class="shot reveal">
        <div class="media">Clip / Screenshot</div>
        <div class="text"><strong></strong><div class="meta">N/A</div></div>
      </article>
      <article class="shot reveal">
        <div class="media">Clip / Screenshot</div>
        <div class="text"><strong></strong><div class="meta">N/A</div></div>
      </article>
    </div>
  </div>
</section>

<section id="about" class="section">
  <div class="container">
    <h2 class="title">About</h2>
    <div class="card reveal">
      <div class="card-body">
        <p>Trackmania Events is a central hub for everything happening in the Trackmania community ‚Äî bringing together live leaderboards, campaign world-records, Track of the Day archives, and player statistics in one clean interface. The goal is to give fans, players, and creators a single place to explore records, follow seasonal updates, and connect with ongoing competitive and creative events across Trackmania.</p>
        <div class="keyfacts" style="margin-top:1rem">
          <a class="btn" href="https://twitch.tv/C0rsy" target="_blank" rel="noreferrer">Follow on Twitch</a>
          <a class="btn" href="#contact">Business / Collabs</a>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="contact" class="section">
  <div class="container">
    <h2 class="title">Contact</h2>
    <div class="grid" style="grid-template-columns:2fr 1fr">
      <form action="https://formspree.io/f/xjkazybj" method="POST" class="card form reveal" id="contact-form">
        <div class="card-body">
          <div class="twocol">
            <div class="field">
              <label for="name">Name</label>
              <input class="input" id="name" name="name" type="text" placeholder="Your name" required />
            </div>
            <div class="field">
              <label for="email">Email</label>
              <input class="input" id="email" name="_replyto" type="email" placeholder="name@example.com" required />
            </div>
          </div>
          <div class="field" style="margin-top:.8rem">
            <label for="message">Message</label>
            <textarea class="textarea" id="message" name="message" rows="5" placeholder="How can we help?" required></textarea>
          </div>
          <div style="margin-top:1rem;display:flex;gap:.6rem;align-items:center">
            <button class="btn primary" type="submit">Send</button>
            <span id="formStatus" style="font-size:0.9rem;" aria-live="polite"></span>
          </div>
        </div>
      </form>
      <aside class="card reveal">
        <div class="card-body">
          <strong>Discord</strong>
          <div class="meta"><a href="https://discord.gg/9bDcTTbTGJ" target="_blank" rel="noreferrer">Join the server</a></div>
        </div>
      </aside>
    </div>
  </div>
</section>

<button id="toTop" aria-label="Back to top">Top</button>

<footer>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap">
    <div>¬© <span id="year"></span> Trackmania Events</div>
    <div><a href="/privacy">Privacy</a> ‚Ä¢ <a href="/terms">Terms</a> ‚Ä¢ <a href="#contact">Contact</a></div>
  </div>
</footer>

<script>
  const TTV_CHANNEL="C0rsy";
  const d=document.getElementById('d');
  const h=document.getElementById('h');
  const m=document.getElementById('m');
  const s=document.getElementById('s');

  const fmtDate=(iso)=>{
    const dt=new Date(iso);
    return dt.toLocaleString(undefined,{month:'short',day:'2-digit',year:'numeric',hour:'numeric',minute:'2-digit'});
  };

  function setCountdown(dd,hh,mm,ss){ if(d) d.textContent=dd; if(h) h.textContent=hh; if(m) m.textContent=mm; if(s) s.textContent=ss; }

  function startCountdown(iso,titleEl){
    function tick(){
      const now=new Date();const then=new Date(iso);let diff=then-now;
      if(diff<=0){setCountdown(0,0,0,0);if(titleEl) titleEl.textContent='Live now!';return;}
      const days=Math.floor(diff/86400000);diff%=86400000;
      const hrs=Math.floor(diff/3600000);diff%=3600000;
      const mins=Math.floor(diff/60000);diff%=60000;
      const secs=Math.floor(diff/1000);
      setCountdown(days,hrs,mins,secs);
    }
    tick();setInterval(tick,1000);
  }

  function attachHoverGlow(){
    document.querySelectorAll('.event').forEach(e=>{
      e.addEventListener('mousemove',ev=>{
        const r=e.getBoundingClientRect();
        e.style.setProperty('--x', `${ev.clientX - r.left}px`);
        e.style.setProperty('--y', `${ev.clientY - r.top}px`);
      });
    });
  }

  function renderFromData(events){
    const now=Date.now();
    const live=events.filter(e=>new Date(e.start_iso)<=now && now<=new Date(e.end_iso)).sort((a,b)=>new Date(a.start_iso)-new Date(b.start_iso));
    const upcoming = events.filter(e => new Date(e.start_iso) > now).sort((a,b)=> new Date(a.start_iso) - new Date(b.start_iso));

    const past=events.filter(e=>new Date(e.end_iso)<=now).sort((a,b)=>new Date(b.end_iso)-new Date(a.end_iso)).slice(0,6);

    const liveSection=document.getElementById('live-events');
    const liveGrid=document.getElementById('live-events-grid');
    if(live.length){
      liveSection.style.display='';
      liveGrid.innerHTML='';
      live.forEach(e=>{
        const el=document.createElement('article');
        el.className='event reveal';
        el.innerHTML=`<span class="tag">LIVE NOW</span>
          <div class="meta">${fmtDate(e.start_iso)} ‚Äî ${fmtDate(e.end_iso)}</div>
          <h4>${e.title}</h4>
          <div class="meta">${e.description||''}</div>`;
        if(e.image){
          el.classList.add('with-bg');
          el.style.setProperty('--event-img',`url("${e.image}")`);
        }
        liveGrid.appendChild(el);
      });
    }else{
      liveSection.style.display='none';
    }

    const grid=document.getElementById('events-grid');
    grid.innerHTML='';
    upcoming.forEach(e=>{
      const el=document.createElement('article');
      el.className='event reveal';
      el.innerHTML=`<span class="tag">${e.tag||'Event'}</span>
        <div class="meta">${fmtDate(e.start_iso)} ‚Äî ${fmtDate(e.end_iso)}</div>
        <h4>${e.title}</h4>
        <div class="meta">${e.description||''}</div>`;
      if(e.image){
        el.classList.add('with-bg');
        el.style.setProperty('--event-img',`url("${e.image}")`);
      }
      grid.appendChild(el);
    });

    let pastWrap=document.getElementById('past-events');
    if(!pastWrap){
      pastWrap=document.createElement('div');
      pastWrap.id='past-events';
      pastWrap.innerHTML=`<h3 class="title" style="margin-top:2rem">Past Events</h3>
        <div class="grid" id="past-grid"></div>`;
      document.querySelector('#schedule .container').appendChild(pastWrap);
    }
    const pastGrid=document.getElementById('past-grid');
    pastGrid.innerHTML='';
    past.forEach(e=>{
      const el=document.createElement('article');
      el.className='event reveal';
      el.innerHTML=`<span class="tag">${e.tag||'Event'}</span>
        <div class="meta">${fmtDate(e.start_iso)} ‚Äî ${fmtDate(e.end_iso)}</div>
        <h4>${e.title}</h4>
        <div class="meta">${e.location||''}</div>`;
      if(e.image){
        el.classList.add('with-bg');
        el.style.setProperty('--event-img',`url("${e.image}")`);
      }
      pastGrid.appendChild(el);
    });

    const next=upcoming[0];
    const chip=document.getElementById('hero-chip');
    const pills=document.getElementById('hero-pills');
    const header=document.getElementById('countdown-title');
    const cdCard=document.getElementById('countdown-card');

    if (live.length) {
  const cur = live[0];

  // Chip shows how many are live; hero promotes the first one.
  chip.textContent = live.length > 1
    ? `üü¢ ${live.length} events live ‚Äî ${cur.title}`
    : `Live now ‚Ä¢ ${cur.title}`;

  pills.innerHTML = `<div class="pill">üü¢ Live</div>
    <div class="pill">üìç ${cur.location || 'Online'}</div>
    <div class="pill">üèÅ ${cur.description || ''}</div>`;

  header.textContent = 'Live now!';
  setCountdown(0, 0, 0, 0);

  const heroImg = cur?.hero_image || cur?.image;
  if (heroImg) cdCard?.style.setProperty('--cd-img', `url("${heroImg}")`);
  else cdCard?.style.removeProperty('--cd-img');

  // Optional: if you have per-event Twitch channels, switch the embed.
  // Safe no-op if setTwitchChannel isn't defined.
  if (cur.twitch && typeof setTwitchChannel === 'function') {
    setTwitchChannel(cur.twitch);
  }

} else if (next) {
  chip.textContent = `Next Event ‚Ä¢ ${next.title}`;
  pills.innerHTML = `<div class="pill">üóìÔ∏è ${fmtDate(next.start_iso)}</div>
    <div class="pill">üìç ${next.location || 'Online'}</div>
    <div class="pill">üèÅ ${next.description || ''}</div>`;

  startCountdown(next.start_iso, header);

  const heroImg = next?.hero_image || next?.image;
  if (heroImg) cdCard?.style.setProperty('--cd-img', `url("${heroImg}")`);
  else cdCard?.style.removeProperty('--cd-img');

} else {
  chip.textContent = 'No upcoming event';
  pills.innerHTML = '<div class="pill">Check back soon</div>';
  header.textContent = 'Countdown';
  setCountdown(0, 0, 0, 0);
  cdCard?.style.removeProperty('--cd-img');
}


    updateJSONLD(live[0]||next||null);
    attachReveals();
    attachHoverGlow();
    window.__eventsCache=events;
  }

  function updateJSONLD(next){
    const el=document.getElementById('event-jsonld');
    if(!next){el.textContent='{}';return;}
    el.textContent=JSON.stringify({
      "@context":"https://schema.org",
      "@type":"Event",
      name:next.title,
      startDate:next.start_iso,
      endDate:next.end_iso,
      eventAttendanceMode:"https://schema.org/OnlineEventAttendanceMode",
      eventStatus:"https://schema.org/EventScheduled",
      location:{"@type":"VirtualLocation","url":"https://trackmaniaevents.com"},
      description:next.description||"",
      image:next.image||undefined,
      organizer:{"@type":"Organization","name":"Trackmania Events","url":"https://trackmaniaevents.com"}
    });
  }

  async function loadEvents(){
    try{
      const res=await fetch('/events.json?cb='+Date.now());
      if(!res.ok) throw new Error('Failed to fetch events.json');
      const data=await res.json();
      renderFromData(Array.isArray(data)?data:[]);
    }catch(err){
      console.error(err);
      const grid=document.getElementById('events-grid');
      grid.innerHTML='<article class="event"><div class="meta">Could not load events.</div></article>';
      const t=document.getElementById('countdown-title'); if(t) t.textContent='Countdown';
      setCountdown(0,0,0,0);
    }
  }

  /* twitch embed */
  (function(){
    const parents=['trackmaniaevents.com','www.trackmaniaevents.com'];
    const embed=document.getElementById('twitch-embed');
    const iframe=document.createElement('iframe');
    iframe.className='player';
    iframe.allowFullscreen=true;
    iframe.allow='autoplay; encrypted-media; picture-in-picture';
    iframe.src=`https://player.twitch.tv/?channel=${encodeURIComponent(TTV_CHANNEL)}&autoplay=false`+parents.map(p=>`&parent=${encodeURIComponent(p)}`).join('')+`&muted=true`;
    embed.appendChild(iframe);
  })();

  /* nav active highlight on scroll */
  (function(){
    const sections=[...document.querySelectorAll('section[id]')];
    const links=[...document.querySelectorAll('.navlinks a')];
    const byId=id=>links.find(a=>a.getAttribute('href')===`#${id}`);
    const io=new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          links.forEach(a=>a.classList.remove('active'));
          const a=byId(e.target.id); if(a) a.classList.add('active');
        }
      });
    },{rootMargin:'-40% 0px -55% 0px',threshold:0});
    sections.forEach(s=>io.observe(s));
  })();

  function attachReveals(){
    const reveals=document.querySelectorAll('.reveal:not(.show)');
    const io2=new IntersectionObserver((entries,obs)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){e.target.classList.add('show');obs.unobserve(e.target);}
      });
    },{threshold:0.12});
    reveals.forEach(el=>io2.observe(el));
  }
  attachReveals();

  (function(){
    const btn=document.getElementById('toTop');
    addEventListener('scroll',()=>btn.classList.toggle('show',scrollY>600));
    btn.onclick=()=>window.scrollTo({top:0,behavior:'smooth'});
  })();

  (function(){
    const btn=document.getElementById('addCal');
    function icsEscape(s){return (s||'').replace(/[\\,;]/g,m=>"\\"+m).replace(/\n/g,"\\n");}
    function dt(iso){return iso.replace(/[-:]/g,"").replace(/\.\d{3}Z$/,'Z');}
    function downloadICS(ev){
      const ics=['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//TrackmaniaEvents//EN','CALSCALE:GREGORIAN','METHOD:PUBLISH','BEGIN:VEVENT',
        'DTSTART:'+dt(ev.start_iso),'DTEND:'+dt(ev.end_iso),'SUMMARY:'+icsEscape(ev.title),
        ev.location?'LOCATION:'+icsEscape(ev.location):'',ev.description?'DESCRIPTION:'+icsEscape(ev.description):'',
        'END:VEVENT','END:VCALENDAR'].filter(Boolean).join('\r\n');
      const blob=new Blob([ics],{type:'text/calendar'});
      const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=(ev.title||'event')+'.ics';a.click();URL.revokeObjectURL(a.href);
    }
    btn?.addEventListener('click',()=>{
      const evts=window.__eventsCache||[];
      const next=(function(evs){const now=Date.now();return evs.filter(e=>new Date(e.end_iso)>now).sort((a,b)=>new Date(a.start_iso)-new Date(b.start_iso))[0];})(evts);
      if(next) downloadICS(next);
    });
  })();

  loadEvents();
  document.getElementById('year').textContent=new Date().getFullYear();
</script>
</body>
</html>
