<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trackmania Events ‚Äî Official Site</title>
  <meta name="description" content="Live Trackmania events, schedule, and stream hub. Watch live on Twitch, see upcoming events, and get in touch." />
  <meta name="theme-color" content="#0a0f1a" />
  <meta property="og:title" content="Trackmania Events ‚Äî Official Site" />
  <meta property="og:description" content="Live Trackmania events, schedule, and stream hub." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://trackmaniaevents.com/" />
  <meta name="twitter:card" content="summary_large_image" />
  <script id="event-jsonld" type="application/ld+json">{}</script>
  <link rel="icon" type="image/png" sizes="32x32" href="/logo.png">
  <link rel="apple-touch-icon" href="/logo.png">
  <link rel="shortcut icon" href="/logo.png">
  <style>
    :root{
      --bg:#0a0f1a;
      --panel:#0f1524;
      --panel-2:#0c1020;
      --text:#e6ecff;
      --muted:#9bb0ff;
      --accent:#3aa0ff;
      --accent-2:#6dfbff;
      --ok:#29d98f;
      --warn:#ffb02e;
      --ring:0 0 0 3px rgba(61,165,255,.25);
      --accent-glow:0 0 24px rgba(61,165,255,.35), 0 0 48px rgba(61,165,255,.2);
      /* hero card target height (countdown & twitch) */
      --heroCardH: 420px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}

    /* ==== THEME: TRACK CURVES (clean, premium) ==== */
    body.bg-track-curves {
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(58,160,255,.10), transparent 60%),
        radial-gradient(900px 500px at 110% 10%, rgba(109,251,255,.08), transparent 70%),
        linear-gradient(180deg, #07101c, #0a0f1a 40%, #060a14 100%);
      color:var(--text);
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }

    /* prettier-ignore */
    body.bg-track-curves::before{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 800' preserveAspectRatio='xMidYMid slice'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%236DAFFF' stop-opacity='.10'/><stop offset='100%' stop-color='%233AE0FF' stop-opacity='.06'/></linearGradient><filter id='blur'><feGaussianBlur stdDeviation='1.4'/></filter></defs><g fill='none' stroke='url(%23g)' stroke-width='2' filter='url(%23blur)'><path d='M-100 700 C300 620 450 480 900 520 C1100 540 1300 620 1400 680'/><path d='M-120 520 C260 460 520 390 940 420 C1180 440 1320 520 1420 600' stroke-width='1.5'/><path d='M-140 350 C220 330 520 300 900 330 C1180 350 1360 420 1500 520' stroke-width='1'/></g></svg>");
      background-size:cover; background-position:center; background-repeat:no-repeat;
      opacity:.6; mix-blend-mode:screen;
    }

    /* prettier-ignore */
    body.bg-track-curves::after{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)' opacity='.035'/></svg>");
      background-size:280px 280px; animation:noiseShift 6s steps(2,end) infinite;
    }
    @keyframes noiseShift{ 50%{transform:translate3d(0,0,0)} 50.01%{transform:translate3d(.5px,.5px,0)} }

    a{color:inherit;text-decoration:none}
    .container{width:min(1200px,92vw);margin:0 auto}

    /* nav */
    header{
      position:sticky;top:0;z-index:50;
      background:linear-gradient(180deg, rgba(10,15,26,.9), rgba(10,15,26,.65) 60%, rgba(10,15,26,0));
      backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(109,251,255,.12)
    }
    .nav{display:flex;align-items:center;justify-content:space-between;padding:.9rem 0}
    .brand{display:flex;align-items:center;gap:.6rem;font-weight:800;letter-spacing:.2px}
    .brand-badge{width:34px;height:34px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--accent-glow);animation:pulseAccent 2.5s infinite ease-in-out;transition:transform .4s ease}
    .brand-badge:hover{transform:rotate(360deg)}
    .brand span:last-child{opacity:.95}
    .navlinks{display:flex;gap:1.25rem}
    .nav a{opacity:.85}
    .nav a:hover,.nav a:focus{opacity:1}
    .nav a.active{opacity:1;position:relative}
    .nav a.active::after{content:"";position:absolute;left:0;right:0;bottom:-6px;height:2px;background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:2px}
    .cta{display:flex;gap:.6rem}
    .btn{padding:.6rem .95rem;border:1px solid rgba(109,251,255,.25);border-radius:12px;background:linear-gradient(180deg, rgba(16,24,44,.9), rgba(16,24,44,.6));color:var(--text);font-weight:700;transition:transform .2s ease, box-shadow .2s ease, filter .2s ease}
    .btn.primary{border-color:transparent;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#001220;box-shadow:var(--accent-glow);animation:pulseAccent 3s infinite ease-in-out}
    .btn:focus{outline:none;box-shadow:var(--ring)}
    .btn:hover{transform:translateY(-1px) scale(1.02);filter:brightness(1.06)}

   /* hero */
.hero{position:relative;padding:clamp(2rem,5vw,4rem) 0 2.5rem;border-radius:16px;overflow:hidden;isolation:isolate;mask-image:radial-gradient(white,black);-webkit-mask-image:-webkit-radial-gradient(white,black);background-clip:padding-box}
.hero::after{content:"";position:absolute;inset:0;background:radial-gradient(circle at 60% 80%,rgba(61,165,255,.2),transparent 70%);mix-blend-mode:screen;opacity:.25;pointer-events:none;border-radius:inherit}
.hero-media{position:relative;border-radius:inherit;overflow:hidden}
.hero-media img,.hero-media video,.hero-media canvas{display:block;width:100%;height:auto;border-radius:inherit;object-fit:cover}
.hero .countdown{position:absolute;left:0;right:0;top:0;z-index:2;pointer-events:none}
.hero-grid{display:block}
.chip{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .65rem;border-radius:999px;font-size:.8rem;color:#001220;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--accent-glow);animation:pulseAccent 3s infinite ease-in-out}
#hero-chip,#live-chip{display:inline-block;width:auto;max-width:fit-content;padding:.4rem .9rem;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001220;font-weight:800;box-shadow:var(--accent-glow)}
.h1{font-size:clamp(2.1rem,3.8vw,3rem);line-height:1.1;margin:.8rem 0 0;font-weight:900;letter-spacing:.4px;text-shadow:0 0 12px rgba(61,165,255,.25)}
.lead{color:var(--muted);max-width:60ch;margin-top:.85rem}
.keyfacts{display:flex;flex-wrap:wrap;gap:.6rem;margin:1.2rem 0}
.pill{padding:.5rem .75rem;border-radius:999px;border:1px solid rgba(109,251,255,.25);background:linear-gradient(180deg,rgba(12,16,32,.7),rgba(12,16,32,.45))}
.hero-top{display:flex;flex-direction:column;gap:1rem}
.hero-row{display:grid;grid-template-columns:1.1fr .9fr;gap:2rem;align-items:start;margin-top:1rem}
.hero-row>div:first-child{margin-top:0}
@media(max-width:900px){.hero-row{grid-template-columns:1fr}.hero .countdown{position:static;margin-top:.75rem}}


    /* glassy cards */
    .card{border:1px solid rgba(109,251,255,.25);background:rgba(15,21,36,.5);backdrop-filter:blur(12px) saturate(180%);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.4), 0 0 20px rgba(61,165,255,.2)}
    .card-header{padding:1rem 1rem .6rem;border-bottom:1px dashed rgba(109,251,255,.2)}
    .card-body{padding:1rem}

   /* >>> hero card sizing (countdown & twitch) */
#countdown-card,
#live .card {min-height: var(--heroCardH);display: flex;flex-direction: column;}


#countdown-card {background-image:linear-gradient(180deg, rgba(10,15,26,.68), rgba(10,15,26,.44)),var(--cd-img, none);background-size: contain, cover;background-position: center, center; background-repeat: no-repeat, no-repeat;overflow: hidden; /* clean edges */}

#countdown-card .card-body {flex: 1;display: flex;flex-direction: column;justify-content: space-between;
}


#live .card-body {flex: 1;display: grid;padding: 0; /* makes embed fill */}
#live .player {width: 100%;height: 100%;display: block;border: 0;border-radius: 0 0 18px 18px;overflow: hidden;}

    /* Countdown tiles bigger */
    .countdown{display:flex;gap:1.0rem;justify-content:space-between}
    .timebox{flex:1;padding:1.2rem;border-radius:14px;text-align:center;background:linear-gradient(180deg, rgba(16,24,44,.9), rgba(16,24,44,.55));border:1px solid rgba(109,251,255,.18);min-height:96px}
    .timebox strong{display:block;font-size:clamp(2rem,3.4vw,2.6rem)}
    .timebox span{color:var(--muted);font-size:.95rem}



    /* sections */
    .section{padding:3rem 0}
    .title{font-size:1.8rem;font-weight:900;margin:0 0 1rem;display:inline-block;position:relative}
    .title::after{content:"";position:absolute;left:0;bottom:-6px;height:2px;width:100%;background:linear-gradient(90deg, var(--accent), var(--accent-2));animation:lineSwipe 3s linear infinite}

    /* grid + events */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
.event{position:relative;padding:1rem;padding-top:3.25rem;border-radius:18px;overflow:hidden;background:linear-gradient(180deg, rgba(20,28,46,.8), rgba(20,28,46,.5));border:1px solid rgba(109,251,255,.18);transition:transform .25s ease, box-shadow .25s ease, filter .25s ease}
.event h4{
  margin:.35rem 0 .25rem;
  letter-spacing:.2px;
  color:#fff;
  text-shadow:0 2px 8px rgba(0,0,0,.7), 0 0 4px rgba(61,165,255,.25);
}
.event .meta{
  color:#d5deff;
  font-size:.9rem;
  text-shadow:0 1px 5px rgba(0,0,0,.6), 0 0 3px rgba(61,165,255,.2);}
.event .tag{position:absolute;top:10px;right:10px;z-index:5;font-size:.7rem;padding:.25rem .5rem;border-radius:999px;border:1px solid rgba(109,251,255,.25);background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#001220;animation:pulseAccent 3s infinite ease-in-out}
.event::before{content:"";position:absolute;inset:0;pointer-events:none;background:radial-gradient(400px circle at var(--x,-100px) var(--y,-100px), rgba(61,165,255,.14), transparent 40%);opacity:0;transition:opacity .25s ease;z-index:1}
.event:hover::before{opacity:1}
.event>.meta:first-of-type{padding-right:120px}
.event.with-bg{background-image:linear-gradient(180deg,rgba(15,21,36,.72),rgba(15,21,36,.45)),var(--event-img);background-size:contain,cover;background-position:center,center;background-repeat:no-repeat,no-repeat;overflow:hidden;background-clip:padding-box,padding-box;min-height:180px;border-radius:16px}
.event.with-bg:hover{background-image:linear-gradient(180deg, rgba(15,21,36,.64), rgba(15,21,36,.40)), var(--event-img);background-size:contain;background-position:center;background-repeat:no-repeat}
.event.with-bg::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  background:linear-gradient(180deg, rgba(8,12,22,.45) 0%, rgba(8,12,22,.55) 55%, rgba(8,12,22,.72) 100%);
  z-index:0;
  pointer-events:none;
}
.event.with-bg > :not(.tag){position:relative; z-index:2;}



    .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
    .shot{overflow:hidden;border-radius:18px;border:1px solid rgba(109,251,255,.16);background:linear-gradient(180deg, rgba(12,16,32,.7), rgba(12,16,32,.45))}
    .shot .media{aspect-ratio:4/3;display:grid;place-items:center;color:var(--muted)}
    .shot .text{padding:1rem}

    footer{border-top:1px solid rgba(109,251,255,.12);padding:1.5rem 0;font-size:.95rem;color:var(--muted)}

    /* (removed) diagonal stripe decorative block */
    .tm-stripes{display:none !important}

    /* reveals */
    .reveal{opacity:0;transform:translateY(30px) scale(.98);transition:opacity .8s ease, transform .8s ease}
    .reveal.show{opacity:1;transform:none}

#toTop {
  position: fixed;
  bottom: 26px;
  right: 26px;
  width: 65px;
  height: 55px;
  border-radius: 12px;
  background: rgba(15, 21, 36, 0.55); /* translucent glass-like background */
  backdrop-filter: blur(10px) saturate(160%);
  border: 1px solid rgba(109, 251, 255, 0.25);
  box-shadow: 0 0 18px rgba(61, 165, 255, 0.35);
  cursor: pointer;

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;

  color: #6dfbff; /* blue text + arrow */
  font-weight: 700;
  font-size: 0.9rem;
  line-height: 1.1;

  opacity: 0;
  pointer-events: none;
  transition: all 0.3s ease;
  z-index: 50;
}

#toTop.show {
  opacity: 1;
  pointer-events: auto;
}

#toTop:hover {
  transform: translateY(-4px);
  box-shadow: 0 0 25px rgba(61, 165, 255, 0.75);
  filter: brightness(1.15);
}

/* arrow above text */
#toTop::before {
  content: "‚Üë";
  display: block;
  font-size: 1.4rem;
  line-height: 1;
  color: #6dfbff;
  margin-bottom: 2px;
  text-shadow: 0 0 8px rgba(61,165,255,0.4);
}

/* ‚ÄúTop‚Äù label */
#toTop span {
  font-size: 0.85rem;
  font-weight: 700;
  letter-spacing: 0.3px;
  text-shadow: 0 0 6px rgba(61,165,255,0.4);
}

    /* mobile */
    .nav-toggle{display:none}
    @media (max-width:960px){
      .grid{grid-template-columns:1fr 1fr}
      .cards{grid-template-columns:1fr 1fr}
      .hero-row{grid-template-columns:1fr}
    }
    @media (max-width:640px){
      .nav-toggle{display:block;border:1px solid rgba(109,251,255,.25);background:linear-gradient(180deg, rgba(16,24,44,.9), rgba(16,24,44,.6));color:var(--text);border-radius:10px;padding:.4rem .6rem}
      .navlinks{display:none;position:absolute;top:58px;left:0;right:0;padding:.75rem;background:linear-gradient(180deg, rgba(10,15,26,.98), rgba(10,15,26,.92));backdrop-filter:blur(8px);border-bottom:1px solid rgba(109,251,255,.12);flex-direction:column;gap:.6rem}
      .navlinks.show{display:flex}
      .grid,.cards{grid-template-columns:1fr}
      .countdown{flex-wrap:wrap}
      .event{padding-top:3.6rem}
    }
    @media (max-width: 640px){
  :root { --heroCardH: 400px; }
  #countdown-card{
    background-size: 100% 100%, auto 65%;
    background-position: center, center 70%;
    background-image:
      linear-gradient(180deg, rgba(10,15,26,.82), rgba(10,15,26,.60)),
      var(--cd-img, none);
  }
}

    #schedule{--section-img:none !important}
    #schedule::before{background:none !important}

    /* forms */
    .form .field{display:flex;flex-direction:column;gap:.35rem}
    .form .twocol{display:grid;grid-template-columns:1fr 1fr;gap:.8rem}
    .input,.textarea{width:100%;padding:.7rem .85rem;border-radius:12px;border:1px solid rgba(109,251,255,.22);background:#0c1224;color:var(--text)}
    .input::placeholder,.textarea::placeholder{color:rgba(155,176,255,.8)}
    .help{font-size:.85rem;color:var(--muted)}
    @keyframes pulseAccent{0%,100%{box-shadow:0 0 8px rgba(61,165,255,.5)}50%{box-shadow:0 0 20px rgba(61,165,255,.9)}}
    @keyframes lineSwipe{0%{opacity:0;transform:scaleX(0)}10%,90%{opacity:1;transform:scaleX(1)}100%{opacity:0;transform:scaleX(0)}}
  </style>
</head>

<body class="bg-track-curves">
<header>
  <div class="container nav">
    <a class="brand" href="#" aria-label="Trackmania Events Home">
      <span class="brand-badge" aria-hidden="true">üéÆ</span>
      <span>Trackmania Events</span>
    </a>
    <button id="navToggle" class="nav-toggle" aria-expanded="false" aria-controls="primary-nav">‚ò∞</button>
    <nav id="primary-nav" class="navlinks" aria-label="Primary">
      <a href="/kacky">Kacky Finishes</a>
      <a href="/wrleaderboard">WR Leaderboard</a>
      <a href="/totd">Track of the Day</a>
    </nav>
    <div class="cta">
      <form id="playerSearch" onsubmit="event.preventDefault();location.href='/player.html?name='+encodeURIComponent(this.q.value.trim());" style="display:flex;gap:.5rem">
  <input class="input" name="q" type="text" placeholder="Search player‚Ä¶" required />
  <button class="btn">View Profile</button>
</form>
      <a class="btn" href="#contact">Contact</a>
    </div>
  </div>
</header>

<script>
  (function(){
    const btn=document.getElementById('navToggle');
    const nav=document.getElementById('primary-nav');
    if(!btn||!nav) return;
    btn.addEventListener('click',()=>{
      const open=nav.classList.toggle('show');
      btn.setAttribute('aria-expanded',open?'true':'false');
    });
  })();
</script>

<section class="hero" id="home">
  <div class="container hero-grid">

    <div class="hero-top">
      <span class="chip" id="hero-chip">Next Event</span>
      <h1 class="h1">Live Trackmania events and community races</h1>
      <p class="lead">Your central hub for upcoming events, live streams, and highlights.</p>

      <div class="keyfacts" id="hero-pills">
        <div class="pill">üóìÔ∏è TBA</div>
        <div class="pill">üìç Online</div>
        <div class="pill">üèÅ Community races</div>
      </div>
    </div>

    <div class="hero-row">
      <div>
        <div class="card" id="countdown-card" aria-live="polite">
          <div class="card-header">
            <strong id="countdown-title">Countdown to green light</strong>
          </div>
          <div class="card-body">
            <div class="countdown" id="countdown">
              <div class="timebox"><strong id="d">0</strong><span>Days</span></div>
              <div class="timebox"><strong id="h">0</strong><span>Hours</span></div>
              <div class="timebox"><strong id="m">0</strong><span>Minutes</span></div>
              <div class="timebox"><strong id="s">0</strong><span>Seconds</span></div>
            </div>
            <div style="margin-top:.9rem">
              <button class="btn" id="addCal">Add to Calendar</button>
            </div>
          </div>
        </div>
      </div>

      <div id="live" class="live">
        <div class="card reveal">
          <div class="card-header"><strong>Live on Twitch</strong></div>
          <div class="card-body">
            <div id="twitch-embed"></div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<section id="live-events" class="section">
  <div class="container">
    <h2 class="title">Live Now</h2>
    <div class="grid" id="live-events-grid"></div>
  </div>
</section>

<section id="schedule" class="section">
  <div class="container">
    <h2 class="title">Upcoming Events</h2>
    <div class="grid" id="events-grid">
      <article class="event"><div class="meta">Loading schedule‚Ä¶</div></article>
    </div>
  </div>
</section>

<section id="showcase" class="section">
  <div class="container">
    <h2 class="title">Highlights</h2>
    <div class="cards">
      <article class="shot reveal">
        <div class="media">Clip / Screenshot</div>
        <div class="text"><strong></strong><div class="meta">N/A</div></div>
      </article>
      <article class="shot reveal">
        <div class="media">Clip / Screenshot</div>
        <div class="text"><strong></strong><div class="meta">N/A</div></div>
      </article>
      <article class="shot reveal">
        <div class="media">Clip / Screenshot</div>
        <div class="text"><strong></strong><div class="meta">N/A</div></div>
      </article>
    </div>
  </div>
</section>

<section id="about" class="section">
  <div class="container">
    <h2 class="title">About</h2>
    <div class="card reveal">
      <div class="card-body">
        <p>Trackmania Events is a central hub for everything happening in the Trackmania community ‚Äî bringing together live leaderboards, campaign world-records, Track of the Day archives, and player statistics in one clean interface. The goal is to give fans, players, and creators a single place to explore records, follow seasonal updates, and connect with ongoing competitive and creative events across Trackmania.</p>
        <div class="keyfacts" style="margin-top:1rem">
          <a class="btn" href="https://twitch.tv/C0rsy" target="_blank" rel="noreferrer">Follow on Twitch</a>
          <a class="btn" href="#contact">Business / Collabs</a>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="contact" class="section">
  <div class="container">
    <h2 class="title">Contact</h2>
    <div class="grid" style="grid-template-columns:2fr 1fr">
      <form action="https://formspree.io/f/xjkazybj" method="POST" class="card form reveal" id="contact-form">
        <div class="card-body">
          <div class="twocol">
            <div class="field">
              <label for="name">Name</label>
              <input class="input" id="name" name="name" type="text" placeholder="Your name" required />
            </div>
            <div class="field">
              <label for="email">Email</label>
              <input class="input" id="email" name="_replyto" type="email" placeholder="name@example.com" required />
            </div>
          </div>
          <div class="field" style="margin-top:.8rem">
            <label for="message">Message</label>
            <textarea class="textarea" id="message" name="message" rows="5" placeholder="How can we help?" required></textarea>
          </div>
          <div style="margin-top:1rem;display:flex;gap:.6rem;align-items:center">
            <button class="btn primary" type="submit">Send</button>
            <span id="formStatus" style="font-size:0.9rem;" aria-live="polite"></span>
          </div>
        </div>
      </form>
      <aside class="card reveal">
        <div class="card-body">
          <strong>Discord</strong>
          <div class="meta"><a href="https://discord.gg/9bDcTTbTGJ" target="_blank" rel="noreferrer">Join the server</a></div>
        </div>
      </aside>
    </div>
  </div>
</section>

<button id="toTop" aria-label="Back to top">Top</button>

<footer>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap">
    <div>¬© <span id="year"></span> Trackmania Events</div>
    <div><a href="/privacy">Privacy</a> ‚Ä¢ <a href="/terms">Terms</a> ‚Ä¢ <a href="#contact">Contact</a></div>
  </div>
</footer>

<script>
  const TTV_CHANNEL="C0rsy";
  const d=document.getElementById('d');
  const h=document.getElementById('h');
  const m=document.getElementById('m');
  const s=document.getElementById('s');

  const fmtDate=(iso)=>{
    const dt=new Date(iso);
    return dt.toLocaleString(undefined,{month:'short',day:'2-digit',year:'numeric',hour:'numeric',minute:'2-digit'});
  };

  function setCountdown(dd,hh,mm,ss){ if(d) d.textContent=dd; if(h) h.textContent=hh; if(m) m.textContent=mm; if(s) s.textContent=ss; }

  function startCountdown(iso,titleEl){
    function tick(){
      const now=new Date();const then=new Date(iso);let diff=then-now;
      if(diff<=0){setCountdown(0,0,0,0);if(titleEl) titleEl.textContent='Live now!';return;}
      const days=Math.floor(diff/86400000);diff%=86400000;
      const hrs=Math.floor(diff/3600000);diff%=3600000;
      const mins=Math.floor(diff/60000);diff%=60000;
      const secs=Math.floor(diff/1000);
      setCountdown(days,hrs,mins,secs);
    }
    tick();setInterval(tick,1000);
  }

  function attachHoverGlow(){
    document.querySelectorAll('.event').forEach(e=>{
      e.addEventListener('mousemove',ev=>{
        const r=e.getBoundingClientRect();
        e.style.setProperty('--x', `${ev.clientX - r.left}px`);
        e.style.setProperty('--y', `${ev.clientY - r.top}px`);
      });
    });
  }

  function renderFromData(events){
    const now=Date.now();
    const live=events.filter(e=>new Date(e.start_iso)<=now && now<=new Date(e.end_iso)).sort((a,b)=>new Date(a.start_iso)-new Date(b.start_iso));
    const upcoming = events.filter(e => new Date(e.start_iso) > now).sort((a,b)=> new Date(a.start_iso) - new Date(b.start_iso));

    const past=events.filter(e=>new Date(e.end_iso)<=now).sort((a,b)=>new Date(b.end_iso)-new Date(a.end_iso)).slice(0,6);

    const liveSection=document.getElementById('live-events');
    const liveGrid=document.getElementById('live-events-grid');
    if(live.length){
      liveSection.style.display='';
      liveGrid.innerHTML='';
      live.forEach(e=>{
        const el=document.createElement('article');
        el.className='event reveal';
        el.innerHTML=`<span class="tag">LIVE NOW</span>
          <div class="meta">${fmtDate(e.start_iso)} ‚Äî ${fmtDate(e.end_iso)}</div>
          <h4>${e.title}</h4>
          <div class="meta">${e.description||''}</div>`;
        if(e.image){
          el.classList.add('with-bg');
          el.style.setProperty('--event-img',`url("${e.image}")`);
        }
        liveGrid.appendChild(el);
      });
    }else{
      liveSection.style.display='none';
    }

    const grid=document.getElementById('events-grid');
    grid.innerHTML='';
    upcoming.forEach(e=>{
      const el=document.createElement('article');
      el.className='event reveal';
      el.innerHTML=`<span class="tag">${e.tag||'Event'}</span>
        <div class="meta">${fmtDate(e.start_iso)} ‚Äî ${fmtDate(e.end_iso)}</div>
        <h4>${e.title}</h4>
        <div class="meta">${e.description||''}</div>`;
      if(e.image){
        el.classList.add('with-bg');
        el.style.setProperty('--event-img',`url("${e.image}")`);
      }
      grid.appendChild(el);
    });

    let pastWrap=document.getElementById('past-events');
    if(!pastWrap){
      pastWrap=document.createElement('div');
      pastWrap.id='past-events';
      pastWrap.innerHTML=`<h3 class="title" style="margin-top:2rem">Past Events</h3>
        <div class="grid" id="past-grid"></div>`;
      document.querySelector('#schedule .container').appendChild(pastWrap);
    }
    const pastGrid=document.getElementById('past-grid');
    pastGrid.innerHTML='';
    past.forEach(e=>{
      const el=document.createElement('article');
      el.className='event reveal';
      el.innerHTML=`<span class="tag">${e.tag||'Event'}</span>
        <div class="meta">${fmtDate(e.start_iso)} ‚Äî ${fmtDate(e.end_iso)}</div>
        <h4>${e.title}</h4>
        <div class="meta">${e.location||''}</div>`;
      if(e.image){
        el.classList.add('with-bg');
        el.style.setProperty('--event-img',`url("${e.image}")`);
      }
      pastGrid.appendChild(el);
    });

    const next=upcoming[0];
    const chip=document.getElementById('hero-chip');
    const pills=document.getElementById('hero-pills');
    const header=document.getElementById('countdown-title');
    const cdCard=document.getElementById('countdown-card');

    if (live.length) {
  const cur = live[0];

  // Chip shows how many are live; hero promotes the first one.
  chip.textContent = live.length > 1
    ? `üü¢ ${live.length} events live ‚Äî ${cur.title}`
    : `Live now ‚Ä¢ ${cur.title}`;

  pills.innerHTML = `<div class="pill">üü¢ Live</div>
    <div class="pill">üìç ${cur.location || 'Online'}</div>
    <div class="pill">üèÅ ${cur.description || ''}</div>`;

  header.textContent = 'Live now!';
  setCountdown(0, 0, 0, 0);

  const heroImg = cur?.hero_image || cur?.image;
  if (heroImg) cdCard?.style.setProperty('--cd-img', `url("${heroImg}")`);
  else cdCard?.style.removeProperty('--cd-img');

  // Optional: if you have per-event Twitch channels, switch the embed.
  // Safe no-op if setTwitchChannel isn't defined.
  if (cur.twitch && typeof setTwitchChannel === 'function') {
    setTwitchChannel(cur.twitch);
  }

} else if (next) {
  chip.textContent = `Next Event ‚Ä¢ ${next.title}`;
  pills.innerHTML = `<div class="pill">üóìÔ∏è ${fmtDate(next.start_iso)}</div>
    <div class="pill">üìç ${next.location || 'Online'}</div>
    <div class="pill">üèÅ ${next.description || ''}</div>`;

  startCountdown(next.start_iso, header);

  const heroImg = next?.hero_image || next?.image;
  if (heroImg) cdCard?.style.setProperty('--cd-img', `url("${heroImg}")`);
  else cdCard?.style.removeProperty('--cd-img');

} else {
  chip.textContent = 'No upcoming event';
  pills.innerHTML = '<div class="pill">Check back soon</div>';
  header.textContent = 'Countdown';
  setCountdown(0, 0, 0, 0);
  cdCard?.style.removeProperty('--cd-img');
}


    updateJSONLD(live[0]||next||null);
    attachReveals();
    attachHoverGlow();
    window.__eventsCache=events;
  }

  function updateJSONLD(next){
    const el=document.getElementById('event-jsonld');
    if(!next){el.textContent='{}';return;}
    el.textContent=JSON.stringify({
      "@context":"https://schema.org",
      "@type":"Event",
      name:next.title,
      startDate:next.start_iso,
      endDate:next.end_iso,
      eventAttendanceMode:"https://schema.org/OnlineEventAttendanceMode",
      eventStatus:"https://schema.org/EventScheduled",
      location:{"@type":"VirtualLocation","url":"https://trackmaniaevents.com"},
      description:next.description||"",
      image:next.image||undefined,
      organizer:{"@type":"Organization","name":"Trackmania Events","url":"https://trackmaniaevents.com"}
    });
  }

  async function loadEvents(){
    try{
      const res=await fetch('/events.json?cb='+Date.now());
      if(!res.ok) throw new Error('Failed to fetch events.json');
      const data=await res.json();
      renderFromData(Array.isArray(data)?data:[]);
    }catch(err){
      console.error(err);
      const grid=document.getElementById('events-grid');
      grid.innerHTML='<article class="event"><div class="meta">Could not load events.</div></article>';
      const t=document.getElementById('countdown-title'); if(t) t.textContent='Countdown';
      setCountdown(0,0,0,0);
    }
  }

  /* twitch embed */
  (function(){
    const parents=['trackmaniaevents.com','www.trackmaniaevents.com'];
    const embed=document.getElementById('twitch-embed');
    const iframe=document.createElement('iframe');
    iframe.className='player';
    iframe.allowFullscreen=true;
    iframe.allow='autoplay; encrypted-media; picture-in-picture';
    iframe.src=`https://player.twitch.tv/?channel=${encodeURIComponent(TTV_CHANNEL)}&autoplay=false`+parents.map(p=>`&parent=${encodeURIComponent(p)}`).join('')+`&muted=true`;
    embed.appendChild(iframe);
  })();

  /* nav active highlight on scroll */
  (function(){
    const sections=[...document.querySelectorAll('section[id]')];
    const links=[...document.querySelectorAll('.navlinks a')];
    const byId=id=>links.find(a=>a.getAttribute('href')===`#${id}`);
    const io=new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          links.forEach(a=>a.classList.remove('active'));
          const a=byId(e.target.id); if(a) a.classList.add('active');
        }
      });
    },{rootMargin:'-40% 0px -55% 0px',threshold:0});
    sections.forEach(s=>io.observe(s));
  })();

  function attachReveals(){
    const reveals=document.querySelectorAll('.reveal:not(.show)');
    const io2=new IntersectionObserver((entries,obs)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){e.target.classList.add('show');obs.unobserve(e.target);}
      });
    },{threshold:0.12});
    reveals.forEach(el=>io2.observe(el));
  }
  attachReveals();

  (function(){
    const btn=document.getElementById('toTop');
    addEventListener('scroll',()=>btn.classList.toggle('show',scrollY>600));
    btn.onclick=()=>window.scrollTo({top:0,behavior:'smooth'});
  })();

  (function(){
    const btn=document.getElementById('addCal');
    function icsEscape(s){return (s||'').replace(/[\\,;]/g,m=>"\\"+m).replace(/\n/g,"\\n");}
    function dt(iso){return iso.replace(/[-:]/g,"").replace(/\.\d{3}Z$/,'Z');}
    function downloadICS(ev){
      const ics=['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//TrackmaniaEvents//EN','CALSCALE:GREGORIAN','METHOD:PUBLISH','BEGIN:VEVENT',
        'DTSTART:'+dt(ev.start_iso),'DTEND:'+dt(ev.end_iso),'SUMMARY:'+icsEscape(ev.title),
        ev.location?'LOCATION:'+icsEscape(ev.location):'',ev.description?'DESCRIPTION:'+icsEscape(ev.description):'',
        'END:VEVENT','END:VCALENDAR'].filter(Boolean).join('\r\n');
      const blob=new Blob([ics],{type:'text/calendar'});
      const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=(ev.title||'event')+'.ics';a.click();URL.revokeObjectURL(a.href);
    }
    btn?.addEventListener('click',()=>{
      const evts=window.__eventsCache||[];
      const next=(function(evs){const now=Date.now();return evs.filter(e=>new Date(e.end_iso)>now).sort((a,b)=>new Date(a.start_iso)-new Date(b.start_iso))[0];})(evts);
      if(next) downloadICS(next);
    });
  })();

  loadEvents();
  document.getElementById('year').textContent=new Date().getFullYear();
</script>
</body>
</html>
