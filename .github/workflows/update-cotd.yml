- name: Run fetcher (current month)
  run: node scripts/cotd-fetcher.js

- name: Run fetcher (previous month)
  run: |
    PREV=$(TZ=UTC date -u -d "$(date -u +%Y-%m-01) -1 day" +%Y-%m)
    node scripts/cotd-fetcher.js "$PREV"

- name: Commit & push if changed
  run: |
    if [[ -n "$(git status --porcelain -- data/totd/)" ]]; then
      git config user.name  "github-actions[bot]"
      git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
      git add data/totd/
      git commit -m "Update monthly COTD JSON [skip ci]"
      git push
    else
      echo "No changes to commit."
    fi
