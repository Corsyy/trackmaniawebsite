<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>WR Leaderboard ‚Äî Trackmania Events</title>
  <meta name="description" content="Trackmania world records for the current official campaign."/>
  <meta name="theme-color" content="#0a0f1a"/>
  <link rel="icon" type="image/png" href="/logo.png">
  <link rel="apple-touch-icon" href="/logo.png">
  <link rel="shortcut icon" href="/logo.png">
  <style>
    :root{--bg:#0a0f1a;--text:#e6ecff;--muted:#9bb0ff;--accent:#3aa0ff;--accent-2:#6dfbff;--accent-glow:0 0 24px rgba(61,165,255,.35),0 0 48px rgba(61,165,255,.2)}
    *{box-sizing:border-box;margin:0;padding:0} html,body{height:100%}
    body.bg-track-curves{background:radial-gradient(1200px 600px at 20% -10%, rgba(58,160,255,.10), transparent 60%),radial-gradient(900px 500px at 110% 10%, rgba(109,251,255,.08), transparent 70%),linear-gradient(180deg,#07101c,#0a0f1a 40%,#060a14 100%);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;-webkit-font-smoothing:antialiased}
    body.bg-track-curves::before{content:"";position:fixed;inset:0;z-index:-1;pointer-events:none;background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 800'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%236DAFFF' stop-opacity='.10'/><stop offset='100%' stop-color='%233AE0FF' stop-opacity='.06'/></linearGradient><filter id='blur'><feGaussianBlur stdDeviation='1.4'/></filter></defs><g fill='none' stroke='url(%23g)' stroke-width='2' filter='url(%23blur)'><path d='M-100 700 C300 620 450 480 900 520 C1100 540 1300 620 1400 680'/><path d='M-120 520 C260 460 520 390 940 420 C1180 440 1320 520 1420 600' stroke-width='1.5'/><path d='M-140 350 C220 330 520 300 900 330 C1180 350 1360 420 1500 520' stroke-width='1'/></g></svg>");background-size:cover;opacity:.6;mix-blend-mode:screen}
    body.bg-track-curves::after{content:"";position:fixed;inset:0;z-index:-1;pointer-events:none;background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='140' height='140'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)' opacity='.035'/></svg>");background-size:280px 280px;animation:noiseShift 6s steps(2,end) infinite}
    a{color:inherit;text-decoration:none}
    header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,rgba(10,15,26,.9),rgba(10,15,26,.65) 60%,rgba(10,15,26,0));backdrop-filter:blur(8px);border-bottom:1px solid rgba(109,251,255,.12)}
    .container{width:min(1200px,92vw);margin:0 auto;display:flex;justify-content:space-between;align-items:center;padding:.9rem 0}
    .brand{display:flex;align-items:center;gap:.6rem;font-weight:800;letter-spacing:.2px}
    .brand-badge{width:34px;height:34px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--accent-glow)}
    .btn{padding:.6rem .95rem;border:1px solid rgba(109,251,255,.25);border-radius:12px;background:linear-gradient(180deg,rgba(16,24,44,.9),rgba(16,24,44,.6));color:var(--text);font-weight:700;transition:.2s}
    .btn:hover{transform:translateY(-1px) scale(1.02);filter:brightness(1.06)}
    main{max-width:1100px;margin:0 auto;padding:1.5rem} h1{font-size:1.7rem;margin-bottom:.4rem;font-weight:900;text-shadow:0 0 12px rgba(61,165,255,.25)} .meta{color:var(--muted);font-size:.95rem;margin-bottom:1rem}
    .card{border:1px solid rgba(109,251,255,.25);background:rgba(15,21,36,.55);backdrop-filter:blur(12px) saturate(180%);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.4),0 0 20px rgba(61,165,255,.2);padding:1rem}
    table{width:100%;border-collapse:collapse} th,td{padding:.75rem;border-bottom:1px solid rgba(255,255,255,.08);text-align:left} th{opacity:.9}
    .time{font-variant-numeric:tabular-nums} .ts{opacity:.7;font-size:.9em}
  </style>
</head>
<body class="bg-track-curves">
<header>
  <div class="container">
    <a class="brand" href="/index.html"><span class="brand-badge">üèÅ</span><span>WR Leaderboard</span></a>
    <a class="btn" href="/index.html">Home</a>
  </div>
</header>

<main>
  <h1>World-Record Leaderboard (Current Official Campaign)</h1>
  <div id="meta" class="meta">Loading‚Ä¶</div>
  <div class="card">
    <table>
      <thead><tr><th>#</th><th>Map UID</th><th>Holder</th><th class="time">WR Time</th><th class="ts">Set</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</main>

<script>
const API_BASE = "https://trackmaniawebsite.onrender.com"; // <-- replace with your Render URL

function fmt(ms){
  var m=Math.floor(ms/60000), s=Math.floor((ms%60000)/1000), x=ms%1000;
  function pad(n,w){return String(n).padStart(w||2,"0")}
  return pad(m)+":"+pad(s)+":"+String(x).padStart(3,"0");
}
function fmtTs(sec){ return sec ? new Date(sec*1000).toLocaleString() : "‚Äî"; }

async function load(){
  try{
    const r = await fetch(API_BASE + "/api/wr-leaderboard");
    const j = await r.json();

    const tb = document.getElementById("rows");
    tb.innerHTML = "";

    (j.rows || []).forEach(function(row, i){
      const tr = document.createElement("tr");
      tr.innerHTML =
        "<td>"+(i+1)+"</td>"+
        "<td>"+row.mapUid+"</td>"+
        "<td>"+(row.holder || row.accountId || "‚Äî")+"</td>"+
        "<td class=\"time\">"+(row.timeMs!=null?fmt(row.timeMs):"‚Äî")+"</td>"+
        "<td class=\"ts\">"+fmtTs(row.timestamp)+"</td>";
      tb.appendChild(tr);
    });

    const ago = Math.max(0, Date.now() - (j.fetchedAt || 0));
    document.getElementById("meta").textContent =
      "Fetched " + Math.round(ago/1000) + "s ago ‚Äî " +
      new Date(j.fetchedAt || Date.now()).toLocaleTimeString();
  }catch(e){
    document.getElementById("meta").textContent = "Failed to load leaderboard.";
    console.error(e);
  }
}
load();
setInterval(load, 15000);
</script>
</body>
</html>
